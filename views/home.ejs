<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Url Shortner</title>
</head>
<style>
    body {
        font-family: Geneva, Verdana, sans-serif;
    }

    table {
        margin-top: 1rem;
    }
</style>

<body>
    <h1>URL Shortner</h1>
    <% if (locals.id) { %>
        <p>URL Generated: <a href="/url/<%= id %>">https://localhost:8000/url/<%= id %></a></p>
    <% } %>
    <form method="POST" action="/url">
        <label for="inputBox">Enter Your Original URL </label>
        <input type="text" placeholder="https://example.com" name="url">
        <button type="submit">Generate</button>
    </form>
    <% if (locals.urls && locals.urls.length> 0) { %>
        <table border="1" cellpadding="5" cellspacing="0">
            <thead>
                <th>S. No</th>
                <th>ShortId</th>
                <th>Redirect</th>
                <th>Clicks</th>
                <% if (locals.urls.some(url=>url.createdBy?.name)) { %>
                    <th>Generated By</th>
                    <% } %>
            </thead>
            <tbody>
                <% urls.forEach((url, index)=> { %>
                    <tr>
                        <td>
                            <%= index+1 %>
                        </td>
                        <td>
                            <%= url.shortId %>
                        </td>
                        <td>
                            <%= url.redirectURL %>
                        </td>
                        <td>
                            <%= url.visitHistory.length %>
                        </td>
                        <% if (url.createdBy?.name) { %>
                            <td>
                                <%= url.createdBy.name || "User not found" %>
                            </td>
                            <% } %>
                    </tr>
                    <% }) %>
            </tbody>
        </table>
    <% } %>
</body>

</html>